--- a/net/minecraft/server/level/ServerEntity.java
+++ b/net/minecraft/server/level/ServerEntity.java
@@ -26,6 +_,7 @@
 import net.minecraft.network.protocol.game.ClientboundUpdateAttributesPacket;
 import net.minecraft.network.protocol.game.VecDeltaCodec;
 import net.minecraft.network.syncher.SynchedEntityData;
+import net.minecraft.server.network.ServerPlayerConnection;
 import net.minecraft.util.Mth;
 import net.minecraft.world.entity.Entity;
 import net.minecraft.world.entity.EquipmentSlot;
@@ -61,7 +_,12 @@
    @Nullable
    private List<SynchedEntityData.DataValue<?>> f_263120_;
 
-   public ServerEntity(ServerLevel p_8528_, Entity p_8529_, int p_8530_, boolean p_8531_, Consumer<Packet<?>> p_8532_) {
+   // CraftBukkit start
+   private final Set<ServerPlayerConnection> trackedPlayers;
+
+   public ServerEntity(ServerLevel p_8528_, Entity p_8529_, int p_8530_, boolean p_8531_, Consumer<Packet<?>> p_8532_,Set<ServerPlayerConnection> trackedPlayers) {
+      this.trackedPlayers = trackedPlayers;
+      // CraftBukkit end
       this.f_8509_ = p_8528_;
       this.f_8513_ = p_8532_;
       this.f_8510_ = p_8529_;
@@ -92,10 +_,9 @@
       if ($$11 instanceof ItemFrame itemframe) {
          if (this.f_8521_ % 10 == 0) {
             ItemStack itemstack = itemframe.m_31822_();
-            if (itemstack.m_41720_() instanceof MapItem) {
-               Integer integer = MapItem.m_151131_(itemstack);
-               MapItemSavedData mapitemsaveddata = MapItem.m_151128_(integer, this.f_8509_);
-               if (mapitemsaveddata != null) {
+         Integer integer = MapItem.m_151131_(itemstack);
+         MapItemSavedData mapitemsaveddata = MapItem.m_42853_(itemstack, this.f_8509_);
+         if (mapitemsaveddata != null) {
                   for(ServerPlayer serverplayer : this.f_8509_.m_6907_()) {
                      mapitemsaveddata.m_77918_(serverplayer, itemstack);
                      Packet<?> packet = mapitemsaveddata.m_164796_(integer, serverplayer);
@@ -104,11 +_,12 @@
                      }
                   }
                }
-            }
 
             this.m_8543_();
          }
       }
+
+
 
       if (this.f_8521_ % this.f_8511_ == 0 || this.f_8510_.f_19812_ || this.f_8510_.m_20088_().m_135352_()) {
          if (this.f_8510_.m_20159_()) {
@@ -215,6 +_,7 @@
    public void m_8534_(ServerPlayer p_8535_) {
       this.f_8510_.m_6452_(p_8535_);
       p_8535_.f_8906_.m_9829_(new ClientboundRemoveEntitiesPacket(this.f_8510_.m_19879_()));
+      net.minecraftforge.event.ForgeEventFactory.onStopEntityTracking(this.f_8510_, p_8535_);
    }
 
    public void m_8541_(ServerPlayer p_8542_) {
@@ -222,6 +_,7 @@
       this.m_289200_(p_8542_, list::add);
       p_8542_.f_8906_.m_9829_(new ClientboundBundlePacket(list));
       this.f_8510_.m_6457_(p_8542_);
+      net.minecraftforge.event.ForgeEventFactory.onStartEntityTracking(this.f_8510_, p_8542_);
    }
 
    public void m_289200_(ServerPlayer p_289562_, Consumer<Packet<ClientGamePacketListener>> p_289563_) {
